import Head from 'next/head';
import styles from '@/styles/Home.module.css';
import { NextPage } from 'next';
import { getUserAccessToken, getUserRefreshToken, setUserAccessToken } from '@/lib/user';

interface HomeProps {
  user: { name: string };
}

const Home: NextPage<HomeProps> = ({ user }) => {
  return (
    <>
      <Head>
        <title>Manito</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <main className={styles.main}>
        <h1>{`username: ${user.name}`}</h1>
      </main>
    </>
  );
};

Home.getInitialProps = async ({ req, res }) => {
  let accessToken = getUserAccessToken({ req, res });
  if (!accessToken) {
    console.log('access token 재발급');
    const refreshToken = getUserRefreshToken({ req, res });
    // refresh token으로 access token 발급

    accessToken = Math.random().toString();
    setUserAccessToken(accessToken, { req, res });
  }

  // access token으로 유저정보 조회
  const user = {
    name: '김현진',
  };

  return {
    user,
  };
};

export default Home;
